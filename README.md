# 综合坐标转换工具

## 项目简介
综合坐标转换工具是一个功能强大的Python脚本，支持多种地理坐标系之间的批量转换，包括WGS84、高德(GCJ-02)和百度(BD09)坐标系。该工具能够智能识别Excel文件中的经纬度列，批量处理数据并生成转换结果，适用于需要在不同地图服务之间转换坐标的场景。

## 功能特点
- 支持6种常用坐标系转换模式
- 智能识别Excel文件中的经纬度列
- 批量处理Excel数据，自动生成转换结果
- 结果文件保留原始数据结构，新增转换列
- 详细日志记录，便于问题排查
- 支持Windows系统的可执行文件版本

## 功能模块

### 1. 坐标转换核心模块
实现了不同坐标系之间的精确转换算法，包括以下函数：

| 函数名 | 功能描述 |
|--------|----------|
| `wgs84_to_gcj02` | WGS84坐标系转高德坐标系(GCJ-02) |
| `gcj02_to_wgs84` | 高德坐标系(GCJ-02)转WGS84坐标系 |
| `gcj02_to_bd09` | 高德坐标系(GCJ-02)转百度坐标系(BD09) |
| `bd09_to_gcj02` | 百度坐标系(BD09)转高德坐标系(GCJ-02) |
| `wgs84_to_bd09` | WGS84坐标系转百度坐标系(BD09) |
| `bd09_to_wgs84` | 百度坐标系(BD09)转WGS84坐标系 |

### 2. Excel文件处理模块
负责Excel文件的读取、数据处理和结果写入，支持.xlsx格式文件。

### 3. 智能列识别模块
通过关键词匹配自动识别Excel中的经纬度列，支持多种命名方式：
- WGS84坐标：包含'WGS84'、'84'等关键词的列
- 高德坐标：包含'高德'、'GCJ02'等关键词的列
- 百度坐标：包含'百度'、'BD09'等关键词的列

### 4. 日志模块
记录程序运行过程中的关键信息和错误，便于问题诊断和排查。

## 使用方法

### 前提条件
- Python 3.x环境
- 依赖库：pandas, openpyxl, math

### 运行步骤
1. 将待转换的Excel文件(.xlsx)放在程序同一目录下
2. 运行程序：`python 综合坐标转换工具.py` 或直接运行可执行文件
3. 根据菜单选择坐标转换模式（1-6）：
   ```
   1. WGS84 → 高德(GCJ-02)
   2. 高德(GCJ-02) → WGS84
   3. WGS84 → 百度(BD-09)
   4. 百度(BD-09) → WGS84
   5. 高德(GCJ-02) → 百度(BD-09)
   6. 百度(BD-09) → 高德(GCJ-02)
   ```
4. 输入要处理的Excel文件名
5. 程序自动处理并生成结果文件，格式为`原文件名-目标坐标系.xlsx`

## 坐标转换核心方法
本工具采用中国国家测绘局发布的坐标偏移算法，核心转换公式如下：

### 经纬度转换函数
```python
def transformlat(x, y):
    ret = -100.0 + 2.0 * x + 3.0 * y + 0.2 * y * y + 0.1 * x * y + 0.2 * math.sqrt(abs(x))
    ret += (20.0 * math.sin(6.0 * x * math.pi) + 20.0 * math.sin(2.0 * x * math.pi)) * 2.0 / 3.0
    ret += (20.0 * math.sin(y * math.pi) + 40.0 * math.sin(y / 3.0 * math.pi)) * 2.0 / 3.0
    ret += (160.0 * math.sin(y / 12.0 * math.pi) + 320 * math.sin(y * math.pi / 30.0)) * 2.0 / 3.0
    return ret

def transformlng(x, y):
    ret = 300.0 + x + 2.0 * y + 0.1 * x * x + 0.1 * x * y + 0.1 * math.sqrt(abs(x))
    ret += (20.0 * math.sin(6.0 * x * math.pi) + 20.0 * math.sin(2.0 * x * math.pi)) * 2.0 / 3.0
    ret += (20.0 * math.sin(x * math.pi) + 40.0 * math.sin(x / 3.0 * math.pi)) * 2.0 / 3.0
    ret += (150.0 * math.sin(x / 12.0 * math.pi) + 300.0 * math.sin(x / 30.0 * math.pi)) * 2.0 / 3.0
    return ret
```

### 坐标系转换原理
1. **WGS84与GCJ02转换**：基于地球椭球模型和国家保密算法，加入随机偏差
2. **GCJ02与BD09转换**：在GCJ02基础上进一步加入百度特有偏差
3. **WGS84与BD09转换**：通过GCJ02作为中间坐标系进行二次转换

## 项目特色

### 1. 智能列识别
无需手动指定经纬度列，程序自动识别包含特定关键词的列，支持多种命名方式，提高工作效率。

### 2. 批量高效处理
支持大型Excel文件的批量转换，保持原始数据结构，转换结果列插入在原始纬度列之后，便于数据对比。

### 3. 全面的转换支持
覆盖所有常用坐标系之间的转换路径，满足不同地图服务（高德地图、百度地图、谷歌地图等）的坐标需求。

### 4. 双重运行模式
既可以作为Python脚本运行，也可以通过提供的可执行文件直接运行，无需配置Python环境。

## 注意事项
1. 确保Excel文件格式正确，经纬度数据为数字格式
2. 程序仅处理.xlsx格式文件，不支持旧版.xls格式
3. 输出文件将保存在同一目录下，文件名包含转换目标坐标系
4. 如遇列识别失败，请检查列名是否包含坐标系关键词

## 错误处理
- 列识别失败：检查Excel列名是否包含正确的坐标系关键词
- 文件不存在：确保输入的文件名正确且文件位于程序目录下
- 权限错误：确保程序对目录有读写权限

所有错误信息将记录在app.log文件中，便于问题排查。